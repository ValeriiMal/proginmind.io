<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-jsx.e3898ebf0382d24403ff.css">/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100}body{color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:#222}.tags__list-item-link:focus,.tags__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.categories__list-item-link{color:#222}.categories__list-item-link:focus,.categories__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body :not(div){max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__date{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.post-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__home-button:focus,.post-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.5rem;line-height:2.4375rem;margin-bottom:1.82813rem}.post-single code{font-size:1.25rem;line-height:2.03125rem}.post-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">It&#x27;s all about layering - Blog by Valerii Maltsev</title><meta data-react-helmet="true" name="description" content="Why do we need to keep our code layered?"/><link as="script" rel="preload" href="/component---src-templates-post-template-jsx-e87a5a16591bd660b46f.js"/><link as="script" rel="preload" href="/app-f7560001493a17b1aff9.js"/><link as="script" rel="preload" href="/3-33c210f6aea9be8bdf5b.js"/><link as="script" rel="preload" href="/0-b8503e2c4e230276dc09.js"/><link as="script" rel="preload" href="/webpack-runtime-5956b358f1db043dc6af.js"/><link rel="preload" href="/static/d/524/path---posts-it-is-all-about-layering-b-8-e-ce4-lW1QMQMTtgofDHAbhZO8R73JIs.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div><a class="post-single__home-button" href="/">All Articles</a></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">It&#x27;s all about layering</h1><div class="post-single__body"><h3>Prerequesites</h3>
<p><a href="https://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a></p>
<p><a href="https://reactjs.org/docs/hooks-intro.html" target="_blank">React hooks</a></p>
<h3>Go</h3>
<p>This article is just my thoughts on how I’m thinking about layering and how to apply it on different levels of the app.
Maybe this help can help you to decide where it is applicable during your work routine.</p>
<p>I found it interesting to think about layered architecture not only in the scope of high-level architecture view but also in low-level project entities. So that layering in one hand is about “divide and conquer” (DC) principle that naturally produces Single Responsibility and Separation Of Concerns principles. And it is also about standardization on the other hand. For me, it is natural to think about almost everything (in the programming world) as of something that can be divided into smaller pieces. I found it exhausted to read articles about patterns, functional programming approaches, different architectures, time management and event human productivity because they often are all partial application of DC law. You can think about almost all parts of life or working process like about something that can be divided into smaller parts. Layering is also about that.</p>
<p>But there is a small difference between terms like “layering” and “decomposition” in programming. “layering” means something standardized, something that you expect to see in different levels of the application. On the other hand, “decomposition” means a more general approach to programming where you trying to extract reusable pieces of functionality.</p>
<p>For example take into consideration standard pattern for frontend applications: MVC. There are three basic layers that you can find in all frontend web applications. VIEW can be exposed using the UI library or framework. CONTROLLER is an object or function with the state that handles events from VIEW and transport data to VIEW. MODEL is something that can store persistent info or state about the application. In React apps that can be app store implemented with Redux or using Context API. In Angular apps that can be Service instance that shares its state between different modules. But this is only implementations that bring the same idea.</p>
<p>Then we can also find this kind of architecture at a higher level. Layering can be expressed through this chain:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">CLIENT -&gt; SERVER -&gt; DATABASE
CLIENT &lt;- SERVER &lt;- DATABASE</code></pre></div>
<p>Something similar to what we have just seen. Three layers. Each layer has one responsibility. You can also mention that each of these layers can also be divided into more layers with smaller granularity. For example, SERVER layer is often divided to VIEW layer that exposes data that can be sent to the client, CONTROLLER that manipulates data from the request and who knows how to deal with the database. DATABASE also is divided: tables are the exact data and there is another layer that can manipulate data. Usually, this is transactions, triggers, stored procedures and so on.</p>
<p>But I’m mostly working with frontend codebase and I found it very useful think about layering before starting to work on something new or maybe if I need to change something that begins to be hard to change or extend.</p>
<p>If you are a React user, you can see the layering of the framework every day. I’m talking about react and react-dom packages. react package knows how to deal with React components, how to calculate changes in them and that’s all at most part. react-dom package knows how to apply changes produced by react to the dedicated platform (in this case browser DOM) and that’s all. It can be expressed like this:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Browser DOM &lt;- ReactDOM &lt;- React &lt;- UI
Natice DOM &lt;- ReactNative &lt;- React &lt;- UI</code></pre></div>
<p>The same thing we can find in react-dnd package as well. There we have react-dnd package that knows how to calculate the state of the drag-n-drop process in the app. And there we have other packages like react-dnd-html5-backend or react-dnd-touch-backend. These packages know how to apply state produced be react-dnd to the dedicated platform.</p>
<p>As you see layering is a great thing that can split abstract API that user deals with from implementation details of different platforms.</p>
<p>Let’s consider a simple form. Forms in an application can be very different but we can standardize approach of how to handle it. All forms need UI. UI can be considered as one of the layers that receive value and expose a function that triggers on form change. If UI does not have a persistent state to store value it is obvious that we need someplace to store it. Again, this is implementation details of how to implement such a state store. React can use context API or Redux store or local state of a component. Angular users can use dedicated service or component’s state. Almost all forms need validation. And this is a good point to have the third layer. We can call it VALIDATION layer and it can be implemented in a reusable and standard way in the application. VALIDATIONshould lie between form UI and value state. It means it should receive form value and produce error object for form value and either changed form value due to business rules or not changed form value. Better to keep this error object in the state near the form value so it is easy to find and change. Let’s visualize what we have for now. There are three layers:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">STATE -&gt; UI
STATE &lt;- VALIDATION &lt;- UI</code></pre></div>
<p>The question can be where to apply this VALIDATION layer. So there is no correct answer. But it is important to keep validators in the same place for every form. For example, let’s keep it between the form controller and state. React users can consider using higher-order components to apply validators. Redux users can consider to user middlewares. Angular users can consider using service or component class.</p>
<p>If you will keep things like that it will be easier to reason about where to find bugs, where to change validation logic or where to change form value business logic etc. It is great to have little standards for your app so everyone knows what to expect in different places of the app.</p>
<p>Here are a few lines of code to bring some visualization here. I’m using React for examples because it needs less code.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// UI layer</span>
<span class="token comment">// -------------------------------------------------</span>
<span class="token comment">// UI doesn't know anything about validation</span>
<span class="token keyword">const</span> <span class="token function-variable function">Form</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">,</span> error<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> onSubmit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                            
  <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                          
    <span class="token operator">&lt;</span>div<span class="token operator">></span>                                                                                           
      <span class="token punctuation">{</span>error <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>p<span class="token operator">></span>Error message here<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>                                                        
      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>onSubmit<span class="token punctuation">}</span><span class="token operator">></span>                                                                    
        <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>                                                 
        <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>                                                       
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>                                                                                       
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>                                                                                          
  <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                  
<span class="token comment">// -------------------------------------------------</span>

<span class="token comment">// VALIDATION layer</span>
<span class="token comment">// -------------------------------------------------</span>
<span class="token comment">// Validation function is static and can be passed as an argument to HOC</span>
<span class="token comment">// This HOC have to be used with components with `onChange` action. This is common interface</span>
<span class="token comment">// for form controls</span>
<span class="token keyword">const</span> <span class="token function-variable function">withError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Wrapped<span class="token punctuation">,</span> validate<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                    

  <span class="token keyword">const</span> <span class="token function-variable function">Component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onError<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                          
    <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                   
      <span class="token function">onChange</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                  
      <span class="token keyword">const</span> validatedData <span class="token operator">=</span> <span class="token function">validate</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>                                               
      <span class="token keyword">if</span> <span class="token punctuation">(</span>validatedData<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                    
        <span class="token comment">// onError handler is attached to the new component created by HOC</span>
        <span class="token function">onError</span><span class="token punctuation">(</span>validatedData<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                     
      <span class="token punctuation">}</span>                                                                                             
    <span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                              

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Wrapped <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Component<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> UiWithErrorHandling <span class="token operator">=</span> <span class="token function">withError</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// -------------------------------------------------</span>

<span class="token comment">// STATE layer</span>
<span class="token comment">// -------------------------------------------------</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>                                                       
                                                                                                    
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                
  <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>                                               
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'change'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                          
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                          
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> error <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>                                                                                     
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                  


<span class="token comment">// Container for the UI layer to store the UI state</span>
<span class="token keyword">const</span> <span class="token function-variable function">StateContainer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                      
  <span class="token comment">// checkout react hooks</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>                                

  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                     
    <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'change'</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                               
  <span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                
                                                                                                    
  <span class="token keyword">const</span> <span class="token function-variable function">handleError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>validationData<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                         
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> validationData <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           
  <span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                
                                                                                                    
  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                   
                                                                                                    
  <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                          
    <span class="token operator">&lt;</span>UiWithErrorHandling                                                                            
      value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span>                                                                           
      error<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>error<span class="token punctuation">}</span>                                                                           
      onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>                                                                       
      <span class="token comment">// this action attached by our VALIDATION layer</span>
      onError<span class="token operator">=</span><span class="token punctuation">{</span>handleError<span class="token punctuation">}</span>                                                                         
      onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span>                                                                       
    <span class="token operator">/</span><span class="token operator">></span>                                                                                              
  <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                
<span class="token punctuation">}</span><span class="token punctuation">;</span>           
<span class="token comment">// -------------------------------------------------</span></code></pre></div>
<p>What about authentication guard? Imagine you don’t want to let the user access the whole component and show some fallback component instead or event login component? Yeap, you are right. And as this is so common logic that we can consider it as a separate layer that knows who can access to components and who can not.</p>
<p>A higher-order component is a good fit for that purpose. Or wait, imagine we are using context to store user value across the app and lets use react’s hook to build our HOC.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// somewhere in the tree user is attached to context</span>
<span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                                                 
  <span class="token comment">// ...                                                                                            </span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                          
    <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token operator">></span>                                                             
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>                                                                                    
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>                                                                         
  <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                  

<span class="token comment">// AUTHGUARD</span>
<span class="token comment">// -------------------------------------------------</span>
<span class="token keyword">const</span> <span class="token function-variable function">withAuth</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Wrapped<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                                                       
  <span class="token keyword">const</span> <span class="token punctuation">{</span> permissions<span class="token punctuation">,</span> FallbackComponent<span class="token punctuation">,</span> fallbackProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>                          

  <span class="token keyword">return</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                       
    
    <span class="token comment">// check user permissions</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUserHasPermissions</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> permissions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                  
      <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                      
        <span class="token operator">&lt;</span>Wrapped <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>                                                                        
      <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                            
    <span class="token punctuation">}</span>                                                                                               

    <span class="token comment">// show fallback component</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FallbackComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                        
      <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                      
        <span class="token operator">&lt;</span>FallbackComponent <span class="token punctuation">{</span><span class="token operator">...</span>fallbackProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>                                                     
      <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                            
    <span class="token punctuation">}</span>                                                                                               

    <span class="token comment">// or fallback text if component not specified</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>                                                                                        
      <span class="token operator">&lt;</span>span<span class="token operator">></span>You are not allowed to see <span class="token keyword">this</span> content<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>                                          
    <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                              
  <span class="token punctuation">}</span><span class="token punctuation">;</span>                                                                                                
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// -------------------------------------------------</span></code></pre></div>
<p>Angular users are familiar with guards as <code class="language-text">canActivate</code> field of route object.</p>
<p>With this new layer our app layered architecture should look like this.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">STATE -&gt; GUARD -&gt; UI
STATE &lt;- VALIDATION &lt;- UI</code></pre></div>
<p>Also, there is a lot of other stuff in the regular frontend app. For example, look at API calls. How would you organize them? Usually, interaction with API looks pretty similar. It means it should have some clearly defined functions and layers that can be easily standardized. For example handling of a different response statuses can be extracted to layer, handling of single-item response or paginated response can be also extracted to layer etc.</p>
<p>In javascript, this things can be implemented in different ways, simple or complex. The main task there is to make layers to be easily found, maintained and extended.</p></div><div class="post-single__date"><em>Published <!-- -->19 Sep 2019</em></div></div><div class="post-single__footer"><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/javascript/">Javascript</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/web/">Web</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/architecture/">Architecture</a></li></ul></div><p class="post-single__footer-text"><a href="https://twitter.com/valeriimaltsev/status/1174782139235209216" target="_blank" rel="noopener noreferrer"><br/> Discuss article on Twitter!</a></p><p class="post-single__footer-text"><a href="https://github.com/ValeriiMal/proginmind.io/blob/master/src/pages/articles/2019-08-18---It-Is-All-About-Layering/index.md" target="_blank" rel="noopener noreferrer"><br/> Check it out on Github!</a></p><hr/></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"posts-it-is-all-about-layering-b8e","path":"/posts/it-is-all-about-layering/"};window.dataPath="524/path---posts-it-is-all-about-layering-b-8-e-ce4-lW1QMQMTtgofDHAbhZO8R73JIs";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f7560001493a17b1aff9.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-b12d9bb3b7a286c12329.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.e3898ebf0382d24403ff.css","/component---src-templates-post-template-jsx-e87a5a16591bd660b46f.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-tag-template-jsx-b6c247e27f17f8eee6ea.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-category-template-jsx-29855c3e555bf87d31cf.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.bd3413590f4031314c23.css","/component---src-templates-page-template-jsx-4c7a563398dfe420f7e1.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-be8d4bbbfa8071caa88b.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-b812208e25350b50652d.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.69a945a11e23dfafac91.css","/component---src-pages-index-jsx-f4b718ab13d8d2ba3c97.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-85cc16106c3baf959b37.js"]};/*]]>*/</script><script src="/webpack-runtime-5956b358f1db043dc6af.js" async=""></script><script src="/0-b8503e2c4e230276dc09.js" async=""></script><script src="/3-33c210f6aea9be8bdf5b.js" async=""></script><script src="/app-f7560001493a17b1aff9.js" async=""></script><script src="/component---src-templates-post-template-jsx-e87a5a16591bd660b46f.js" async=""></script></body></html>