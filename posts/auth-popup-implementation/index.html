<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-jsx.56e3f984ff0348eeb558.css">/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100}body{color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:#222}.tags__list-item-link:focus,.tags__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.categories__list-item-link{color:#222}.categories__list-item-link:focus,.categories__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body :not(div){max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__date{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.post-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__home-button:focus,.post-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Auth Popup - Blog by Valerii Maltsev</title><meta data-react-helmet="true" name="description" content="How to implement popup for authorization third party APIs"/><link as="script" rel="preload" href="/component---src-templates-post-template-jsx-608160b77005b6b34503.js"/><link as="script" rel="preload" href="/app-af357c4eb866f8f8603c.js"/><link as="script" rel="preload" href="/3-c1b596d22345e3e9c7d1.js"/><link as="script" rel="preload" href="/0-b8503e2c4e230276dc09.js"/><link as="script" rel="preload" href="/webpack-runtime-367d7c0d0660ac58f450.js"/><link rel="preload" href="/static/d/291/path---posts-auth-popup-implementation-6-e-5-f24-fQVxhhg8hbPdfnwWjjG5kHWz6GQ.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div><a class="post-single__home-button" href="/">All Articles</a></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">Auth Popup</h1><div class="post-single__body"><p>It was interesting to me how to implement the “Sign in with …” button. When this button
clicked new popup appears and takes care of auth flow. When I implemented that feature
I decided to introduce a solution to people like one of the possible way to achieve that.</p>
<p>In general, there are two main paths:</p>
<ol>
<li>opening popup with correct URL</li>
<li>closing popup and read results of the auth flow</li>
</ol>
<p>Let’s do it step by step</p>
<h3>Prerequesites</h3>
<p><a href="https://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a></p>
<p><a href="https://hackernoon.com/understanding-async-await-in-javascript-1d81bb079b2c" target="_blank">async/await</a></p>
<p><a href="https://www.learnrxjs.io/" target="_blank">RxJS Observable</a></p>
<h3>Opening popup</h3>
<p>Except for a new window, there are other containers where you can do that auth flow:</p>
<ul>
<li>new tab of the browser</li>
<li>iframe</li>
</ul>
<p>For the current example, let’s take a look at new window popup as an auth flow container.</p>
<p>There is a widely known way to open a popup.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>url<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>name<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>settingstring<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Note that <code class="language-text">open()</code> function have to be called synchronously, in other words directly
in user action listener function. In other cases, if you decided to call it asynchronously,
browsers block such popups.</p>
<p>For example, the simplest click handler will be fine:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">signIn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> poppup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Url</h3>
<p>Every third party OAuth API provides documentation of how to construct correct URL for auth flow. One of the main query parameters should be called <code class="language-text">redrect_uri</code>.
<a href="https://developers.google.com/identity/protocols/OAuth2UserAgent" target="_blank">There</a> is Google’s OAuth flow URL parameters documented. Check Step 2 -> OAuth Endpoints tab.</p>
<p>So URL for the newly opened popup can be like this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`https://accounts.google.com/o/oauth2/v2/auth?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>queryParamsString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>where <code class="language-text">queryParamsString</code> is:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const queryParamsString = &#39;&#39; +
&#39;client_id={id}&amp;&#39; +
&#39;redirect_uri={our web app or server API url}&amp;&#39; +
&#39;response_type=token&amp;&#39; +
&#39;scope=admin&#39;</code></pre></div>
<p>Sometimes URL for that popup have to be calculated on API side and you as a frontend developer
have to retrieve it first in order to use in your popup. In that case, we can always open
popup synchronously with blank <url> argument, then load our <code class="language-text">redirect_url</code> from the API and
set it to our popup using <code class="language-text">location</code> window’s API. Just like that:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> clickHandler <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  popup<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>That will redirect our popup window to the required URL. After that action, we can’t control
popup behaviour any more, except actions like closing that we are not interested in yet.</p>
<h3>Checking popup state</h3>
<p>After a redirecting popup to the URL with a different host from our’s, we should start the process of
continuous checking popup’s <code class="language-text">location.href</code>. You may notice that trying to read that field
throws an error about restricted access to that field. It is ok, do not try to fix that!
Instead, we should wrap that field access to <code class="language-text">try/catch</code> block.
On that point, we need to use setInterval() with a callback that checks the location of the popup.
When you start to have access to the <code class="language-text">href</code> field and it is one of <code class="language-text">sucess_url</code> or <code class="language-text">error_url</code> we can
close popup with <code class="language-text">popup.close()</code> and set according to result to our app.</p>
<p>There is some pseudo code with promises for that implementation:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> handleOpenPopup <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  popup<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">checkPopup</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> authSuccessful<span class="token punctuation">:</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkPopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span>popup<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">href</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> popup<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> currentHref<span class="token punctuation">;</span> 
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        currentHref <span class="token operator">=</span> <span class="token function">href</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// popup doesn't have success or error href</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> isSuccess <span class="token operator">=</span> currentHref <span class="token operator">===</span> <span class="token string">'success_url'</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> isHrefValid <span class="token operator">=</span> isSuccess <span class="token operator">||</span> currentHref <span class="token operator">===</span> <span class="token string">'error_url'</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isHrefValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you are not familiar with <code class="language-text">Promise</code> and <code class="language-text">async / await</code> keywords there is similar logic implemented with Rx’s <code class="language-text">Observable</code> stream:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleOpenPopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'width=500,height=500'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// () -> Observable&lt;string></span>
  <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token comment">// good operator for side effects like this</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      popup<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// string -> number</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// number -> string | undefined</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>popup<span class="token punctuation">.</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">FAILED_URL</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">getHref</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// string | undefined -> string</span>
    <span class="token comment">// filter only valid results</span>
    <span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// string -> bool</span>
    <span class="token function">map</span><span class="token punctuation">(</span>href <span class="token operator">=></span> href <span class="token operator">===</span> <span class="token constant">SUCCESS_URL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    popup<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> authSuccessful<span class="token punctuation">:</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Window -> string | undefined</span>
<span class="token keyword">const</span> <span class="token function-variable function">getHref</span> <span class="token operator">=</span> <span class="token punctuation">(</span>popup<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> href<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    href <span class="token operator">=</span> popup<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to get href. Popup window has origin that differs from your\'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> href<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I prefer this one to promises because it is easy to implement data flow with atomic operations and it is easy to reason about each operation. Also here is an <a href="https://codepen.io/valmal/pen/gEWoPg" target="_blank">Example</a> of simple implementation of that flow. Check it out!</p>
<h3>And that’s it!</h3>
<p>Let’s review our steps:</p>
<ol>
<li>Open popup synchronously on user action</li>
<li>get popup URL either synchronously or asynchronously</li>
<li>Set <code class="language-text">popup.location.href</code> to obtained URL</li>
<li>Start popup checking</li>
<li>Wait when popup will be redirected back to success or error URL so that we can read them</li>
<li>Check the result</li>
<li>Close popup and handle result</li>
</ol></div><div class="post-single__date"><em>Published <!-- -->3 Jan 2019</em></div></div><div class="post-single__footer"><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/javascript/">Javascript</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/tags/web/">Web</a></li></ul></div><p class="post-single__footer-text"><a href="https://twitter.com/valeriimaltsev/status/1103025489227251713" target="_blank" rel="noopener noreferrer"><br/> Discuss article on Twitter!</a></p><p class="post-single__footer-text"><a href="https://github.com/ValeriiMal/proginmind.io/blob/master/src/pages/articles/2019-03-01---Integration-Popup-Implementation/index.md" target="_blank" rel="noopener noreferrer"><br/> Check it out on Github!</a></p><hr/></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"posts-auth-popup-implementation-6e5","path":"/posts/auth-popup-implementation/"};window.dataPath="291/path---posts-auth-popup-implementation-6-e-5-f24-fQVxhhg8hbPdfnwWjjG5kHWz6GQ";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-af357c4eb866f8f8603c.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-b12d9bb3b7a286c12329.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.bd3413590f4031314c23.css","/component---src-templates-page-template-jsx-c6c2af35ca844a8be41f.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.56e3f984ff0348eeb558.css","/component---src-templates-post-template-jsx-608160b77005b6b34503.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-tag-template-jsx-3b31d0c36865477de698.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-category-template-jsx-7082014e2c380f13bea2.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-be8d4bbbfa8071caa88b.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-b812208e25350b50652d.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.69a945a11e23dfafac91.css","/component---src-pages-index-jsx-8b422c1f17dfb2399f01.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-85cc16106c3baf959b37.js"]};/*]]>*/</script><script src="/webpack-runtime-367d7c0d0660ac58f450.js" async=""></script><script src="/0-b8503e2c4e230276dc09.js" async=""></script><script src="/3-c1b596d22345e3e9c7d1.js" async=""></script><script src="/app-af357c4eb866f8f8603c.js" async=""></script><script src="/component---src-templates-post-template-jsx-608160b77005b6b34503.js" async=""></script></body></html>